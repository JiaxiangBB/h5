function payWayCtrl(a,e,o,t,r){a.customerNo=getURLParameter("customerNo"),a.sessionId=localStorage.getItem("data"),a.customerNameCN=localStorage.getItem("customerNameData"),a.mobile=localStorage.getItem("mobileData"),a.certNo=localStorage.getItem("certNoData");var n=angular.fromJson(t.josnObj);a.dataType=n.dataType,a.money=n.money,a.payType=n.payType,a.fullCardNo=n.fullCardNo,a.bankCardType=n.bankCardType,$(".payWay li i img").attr("src",imgRrc+"h5images/icon_jinru_black"+variable+".png");var s={};s.customerNo=a.customerNo,$.ajax({url:getRootPath()+"/PrepaidCardAction.cardQuery.do?FAPView=JSON",type:"post",data:s,success:function(e){var o=(e=$.parseJSON(e)).data.bankcard,t=e.data.cdcard;if(0==e.FAPStatus){if(1==e.success){if(o.length>0)for(b=0;b<o.length;b++){var r,s,l,p=o[b].BANKTYPE,i=o[b].ACCOUNTNO,y=o[b].BANKNAME,c="";c=bankCard(y,c),"0"==p?(r="储蓄卡",s="",l="",$(".payWay ul").prepend('<li class="saoMaFu" data-type="2"><span><img src="'+c+'"></span><p '+l+">"+y+r+"(尾号"+i.substr(i.length-4)+")"+s+'</p><i><img src="'+imgRrc+"h5images/icon_jinru_black"+variable+'.png"></i><b style="display:none">'+i+"<b/></li>")):(r="信用卡",s="<br>此交易不支持使用信用卡",l='style="margin-top: 0.09rem"',$(".payWay ul").prepend('<li class="balance all saoMaFu" data-type="3"><span><img src="'+c+'"></span><p '+l+">"+y+r+"(尾号"+i.substr(i.length-4)+")"+s+'</p><i><img src="'+imgRrc+"h5images/icon_jinru_black"+variable+'.png"></i><b class="bankCardHao" style="display:none">'+i+"<b/></li>"))}if(t.length>0)for(b=0;b<t.length;b++){var m=t[b].BALANCE,d=t[b].CARDNO;$(".payWay ul").prepend('<li  class="balance all BALANCE'+b+'" data-type="1"><span><img src="'+imgRrc+"h5images/icon_jinegai_yellow"+variable+'.png"></span><p>全时通卡尾号('+d.substr(d.length-4)+")<br>余额("+fmoney(m,2)+')元</p><i><img src="'+imgRrc+"h5images/icon_jinru_black"+variable+'.png"></i><b class="fullCardHao" style="display:none">'+d+"<b/></li>"),a.money>m&&$(".BALANCE"+b).css("opacity","0.4")}$(".payWay ul").prepend('<li class="all avabalance" data-type="0"><span><img src="'+imgRrc+"h5images/icon_qstcard_yue"+variable+'.png"></span><p>账户余额('+fmoney(e.data.avabalance,2)+')元</p><i><img src="'+imgRrc+"h5images/icon_jinru_black"+variable+'.png"></i><b style="display:none"><b/></li>');for(var b=0;b<$(".payWay ul li").length;b++){var g=$(".payWay ul li").eq(b).attr("data-type");a.dataType==g&&$(".payWay ul li").eq(b).css("opacity","0.4")}"4"==a.dataType&&$(".balance").css("opacity","0.4"),"5"==a.dataType&&$(".all").css("opacity","0.4"),"7"==a.dataType&&$(".saoMaFu").css("opacity","0.4"),a.money>e.data.avabalance&&$(".avabalance").css("opacity","0.4"),$(".payWay ul li").off("click").live("click",function(){var e,o=$(this);if(""==o.find("b").text()?a.paytype="01":a.paytype="26",n.orderno){var t=n.orderno,r=n.amount;e={customerNameCN:a.customerNameCN,mobileNo:a.mobile,certNo:a.certNo,cardNo:o.find(".bankCardHao").text(),bankCardType:o.find("p").text(),fullCardNo:a.fullCardNo,money:a.money,orderno:t,amount:r}}else if("1"==n.phoneType){var s=n.mobile,l=n.sellPrice,p=n.areaName,i=n.carrierName,y=n.ppiId;e={cardNo:o.find("b").text(),bankCardType:o.find("p").text(),money:l,mobile:s,sellPrice:a.money,areaName:p,carrierName:i,ppiId:y,payType:a.paytype}}else e="2"==n.phoneType?{mobilePhone:n.mobilePhone,type:n.type,cardNo:o.find("b").text(),bankCardType:o.find("p").text(),money:n.moneyFlow,productId:n.ppiId,flow:n.flow,payType:a.paytype}:n.receiverName?{certNo:a.certNo,cardNo:o.find("b").text(),bankCardType:o.find("p").text(),money:a.money}:"7"==a.dataType&"0"==a.payType?{dataType:a.dataType,money:a.money,payType:a.payType,fullCardNo:o.find("b").text()}:{customerNameCN:a.customerNameCN,mobileNo:a.mobile,certNo:a.certNo,cardNo:o.find(".bankCardHao").text(),bankCardType:o.find("p").text(),fullCardNo:a.fullCardNo,money:a.money};a.payWay(o,e)})}}else 2==e.FAPStatus&&loginH5Host()},error:function(){}}),a.payWay=function(r,s){var l={certNo:a.certNo,customerNameCN:a.customerNameCN,mobileNo:a.mobile},p=angular.toJson(l),i=angular.toJson(s);if(1==r.css("opacity"))if("6"!=r.attr("data-type"))if("0"==a.payType)o.go("sweepTheYard",{jsonPayObj:i});else if("1"==a.payType)o.go("applyPayPassword",{josnObj:p,jsonPayObj:i});else if("2"==a.payType){var y={customerNameCN:a.customerNameCN,mobileNo:a.mobileNo,certNo:a.certNo},c=angular.toJson(y);e.clearCache(),o.go("bankPhoneCode",{jsonAccountObj:c,jsonPayObj:i})}else if("3"==a.payType)e.clearCache(),o.go("rechfullTimeCard",{josnObj:i});else if("4"==a.payType){var l=angular.fromJson(t.josnObj),p=angular.toJson(l);""==r.find("b").text()?o.go("paymentPassword",{josnObj:p,jsonPayObj:i}):o.go("paymentMessage",{josnObj:p,jsonPayObj:i})}else"5"==a.payType&&("1"==n.phoneType?""==r.find("b").text()?o.go("payPassword",{josnObj:p,jsonPayObj:i}):o.go("payMessage",{josnObj:p,jsonPayObj:i}):"2"==n.phoneType&&(""==r.find("b").text()?o.go("payPasswordFlow",{jsonPayObj:i}):o.go("payMessageFlow",{jsonPayObj:i})));else o.go("addBank",{josnObj:p})}}angular.module("myapp").controller("payWayCtrl",["$scope","$ionicHistory","$state","$stateParams","$ionicModal",payWayCtrl]);